"use strict";
const html_minifier_1 = require("html-minifier");
const source_map_1 = require("source-map");
let minifierOptions = {
    caseSensitive: false,
    collapseBooleanAttributes: true,
    collapseInlineTagWhitespace: false,
    collapseWhitespace: true,
    conservativeCollapse: true,
    decodeEntities: false,
    html5: true,
    includeAutoGeneratedTags: true,
    keepClosingSlash: false,
    minifyCSS: false,
    minifyJS: false,
    minifyURLs: false,
    preserveLineBreaks: false,
    preventAttributesEscaping: false,
    processConditionalComments: false,
    removeAttributeQuotes: false,
    removeComments: true,
    removeEmptyAttributes: false,
    removeEmptyElements: false,
    removeOptionalTags: false,
    removeRedundantAttributes: true,
    removeScriptTypeAttributes: true,
    removeStyleLinkTypeAttributes: true,
    removeTagWhitespace: false,
    sortAttributes: true,
    sortClassName: true,
    trimCustomFragments: false,
    useShortDoctype: false
};
module.exports = function (html) {
    let template = html_minifier_1.minify(html, minifierOptions).trim();
    if (this.resourcePath.toLowerCase().endsWith('.vue.html')) {
        this.emitWarning('HTML was imported as plain string: Importing .vue.html module has been obsoleted due to improved .vue Single-File Components tooling!');
    }
    template = JSON.stringify(template);
    template = 'module.exports = ' + template;
    if (this.sourceMap) {
        let gen = new source_map_1.SourceMapGenerator({
            file: this.resourcePath + '.js'
        });
        gen.addMapping({
            source: this.resourcePath,
            generated: {
                column: 0,
                line: 1
            },
            original: {
                column: 0,
                line: 1
            }
        });
        gen.setSourceContent(this.resourcePath, html);
        let sm = gen.toJSON();
        this.callback(null, template, sm);
    }
    else {
        this.callback(null, template);
    }
};
